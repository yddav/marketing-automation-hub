/**\n * Analytics Dashboard System\n * Real-time performance tracking across all marketing channels\n */\n\nconst { DateTime } = require('luxon');\nconst fs = require('fs').promises;\nconst path = require('path');\n\nclass AnalyticsDashboard {\n  constructor(config) {\n    this.config = config;\n    \n    this.metrics = {\n      social: {\n        platforms: ['instagram', 'twitter', 'facebook', 'linkedin'],\n        totalPosts: 0,\n        totalReach: 0,\n        totalEngagement: 0,\n        averageEngagementRate: 0,\n        topPerformingPost: null,\n        bestPerformingPlatform: null,\n        dailyMetrics: [],\n        platformBreakdown: {}\n      },\n      email: {\n        campaigns: 0,\n        totalSent: 0,\n        deliveryRate: 0,\n        openRate: 0,\n        clickRate: 0,\n        conversionRate: 0,\n        revenue: 0,\n        unsubscribeRate: 0,\n        bestPerformingSequence: null,\n        recentCampaigns: []\n      },\n      automation: {\n        activeAutomations: 0,\n        totalTimeSaved: 0,\n        successRate: 0,\n        errorRate: 0,\n        mostUsedTemplate: null,\n        automationEfficiency: 0,\n        scheduledTasks: 0,\n        completedTasks: 0\n      },\n      roi: {\n        totalRevenue: 0,\n        marketingSpend: 0,\n        roi: 0,\n        costPerAcquisition: 0,\n        lifetimeValue: 0,\n        paybackPeriod: 0,\n        revenueGrowth: 0,\n        profitMargin: 0\n      },\n      website: {\n        visitors: 0,\n        pageViews: 0,\n        bounceRate: 0,\n        averageSessionDuration: 0,\n        conversionRate: 0,\n        topPages: [],\n        trafficSources: {},\n        deviceBreakdown: {}\n      }\n    };\n    \n    this.widgets = {\n      overview: {\n        id: 'overview',\n        title: 'Marketing Overview',\n        type: 'multi-metric',\n        size: 'large',\n        data: [],\n        refreshRate: 300000 // 5 minutes\n      },\n      socialPerformance: {\n        id: 'social-performance',\n        title: 'Social Media Performance',\n        type: 'chart',\n        chartType: 'line',\n        size: 'medium',\n        data: [],\n        refreshRate: 600000 // 10 minutes\n      },\n      emailCampaigns: {\n        id: 'email-campaigns',\n        title: 'Email Campaign Metrics',\n        type: 'funnel',\n        size: 'medium',\n        data: [],\n        refreshRate: 900000 // 15 minutes\n      },\n      roiTracking: {\n        id: 'roi-tracking',\n        title: 'ROI & Revenue Tracking',\n        type: 'gauge',\n        size: 'medium',\n        data: [],\n        refreshRate: 3600000 // 1 hour\n      },\n      automationHealth: {\n        id: 'automation-health',\n        title: 'Automation Health',\n        type: 'status',\n        size: 'small',\n        data: [],\n        refreshRate: 300000 // 5 minutes\n      },\n      topContent: {\n        id: 'top-content',\n        title: 'Top Performing Content',\n        type: 'table',\n        size: 'medium',\n        data: [],\n        refreshRate: 1800000 // 30 minutes\n      },\n      trafficSources: {\n        id: 'traffic-sources',\n        title: 'Traffic Sources',\n        type: 'donut',\n        size: 'small',\n        data: [],\n        refreshRate: 1800000 // 30 minutes\n      },\n      conversionFunnel: {\n        id: 'conversion-funnel',\n        title: 'Marketing Funnel',\n        type: 'funnel',\n        size: 'large',\n        data: [],\n        refreshRate: 3600000 // 1 hour\n      }\n    };\n    \n    this.alerts = {\n      thresholds: {\n        lowEngagement: 0.02, // 2%\n        highUnsubscribe: 0.005, // 0.5%\n        lowDelivery: 0.95, // 95%\n        automationFailure: 0.05, // 5%\n        roiThreshold: 3.0 // 300%\n      },\n      active: [],\n      history: []\n    };\n    \n    this.reports = {\n      daily: [],\n      weekly: [],\n      monthly: [],\n      custom: []\n    };\n    \n    this.realTimeListeners = new Map();\n    this.lastUpdate = DateTime.now();\n  }\n\n  /**\n   * Initialize dashboard and start real-time updates\n   */\n  async initialize() {\n    console.log('ðŸš€ Initializing Analytics Dashboard...');\n    \n    // Load historical data\n    await this.loadHistoricalData();\n    \n    // Initialize widgets with current data\n    await this.refreshAllWidgets();\n    \n    // Start real-time data collection\n    this.startRealTimeUpdates();\n    \n    // Setup automated reports\n    this.scheduleReports();\n    \n    console.log('âœ… Analytics Dashboard initialized successfully');\n  }\n\n  /**\n   * Load historical data from storage\n   */\n  async loadHistoricalData() {\n    try {\n      const dataPath = path.join(__dirname, 'data', 'historical-metrics.json');\n      const historicalData = await fs.readFile(dataPath, 'utf8');\n      const data = JSON.parse(historicalData);\n      \n      // Merge historical data with current metrics\n      this.metrics = { ...this.metrics, ...data };\n      \n      console.log('ðŸ“Š Historical data loaded');\n    } catch (error) {\n      console.log('ðŸ“Š No historical data found, starting fresh');\n      // Create initial data structure\n      await this.saveHistoricalData();\n    }\n  }\n\n  /**\n   * Save current metrics to storage\n   */\n  async saveHistoricalData() {\n    try {\n      const dataPath = path.join(__dirname, 'data');\n      await fs.mkdir(dataPath, { recursive: true });\n      \n      const filePath = path.join(dataPath, 'historical-metrics.json');\n      await fs.writeFile(filePath, JSON.stringify(this.metrics, null, 2));\n    } catch (error) {\n      console.error('Failed to save historical data:', error);\n    }\n  }\n\n  /**\n   * Update social media metrics\n   */\n  async updateSocialMetrics(platformData) {\n    const social = this.metrics.social;\n    \n    for (const [platform, data] of Object.entries(platformData)) {\n      if (!social.platformBreakdown[platform]) {\n        social.platformBreakdown[platform] = {\n          posts: 0,\n          reach: 0,\n          engagement: 0,\n          followers: 0,\n          engagementRate: 0\n        };\n      }\n      \n      const platformMetrics = social.platformBreakdown[platform];\n      platformMetrics.posts += data.posts || 0;\n      platformMetrics.reach += data.reach || 0;\n      platformMetrics.engagement += data.engagement || 0;\n      platformMetrics.followers = data.followers || platformMetrics.followers;\n      platformMetrics.engagementRate = data.engagement / data.reach;\n      \n      // Update totals\n      social.totalPosts += data.posts || 0;\n      social.totalReach += data.reach || 0;\n      social.totalEngagement += data.engagement || 0;\n    }\n    \n    // Calculate average engagement rate\n    social.averageEngagementRate = social.totalEngagement / social.totalReach;\n    \n    // Find best performing platform\n    social.bestPerformingPlatform = this.getBestPerformingPlatform();\n    \n    // Add daily metrics\n    social.dailyMetrics.push({\n      date: DateTime.now().toISODate(),\n      reach: social.totalReach,\n      engagement: social.totalEngagement,\n      posts: social.totalPosts\n    });\n    \n    // Keep only last 30 days\n    if (social.dailyMetrics.length > 30) {\n      social.dailyMetrics = social.dailyMetrics.slice(-30);\n    }\n    \n    await this.checkSocialAlerts();\n  }\n\n  /**\n   * Update email marketing metrics\n   */\n  async updateEmailMetrics(emailData) {\n    const email = this.metrics.email;\n    \n    email.campaigns += emailData.campaigns || 0;\n    email.totalSent += emailData.sent || 0;\n    \n    // Calculate rates\n    email.deliveryRate = emailData.delivered / emailData.sent;\n    email.openRate = emailData.opened / emailData.delivered;\n    email.clickRate = emailData.clicked / emailData.opened;\n    email.conversionRate = emailData.converted / emailData.clicked;\n    email.unsubscribeRate = emailData.unsubscribed / emailData.delivered;\n    \n    // Revenue tracking\n    email.revenue += emailData.revenue || 0;\n    \n    // Track recent campaigns\n    if (emailData.campaignDetails) {\n      email.recentCampaigns.unshift({\n        id: emailData.campaignDetails.id,\n        name: emailData.campaignDetails.name,\n        type: emailData.campaignDetails.type,\n        sent: emailData.sent,\n        openRate: email.openRate,\n        clickRate: email.clickRate,\n        revenue: emailData.revenue,\n        date: DateTime.now().toISO()\n      });\n      \n      // Keep only last 10 campaigns\n      if (email.recentCampaigns.length > 10) {\n        email.recentCampaigns = email.recentCampaigns.slice(0, 10);\n      }\n    }\n    \n    await this.checkEmailAlerts();\n  }\n\n  /**\n   * Update automation metrics\n   */\n  async updateAutomationMetrics(automationData) {\n    const automation = this.metrics.automation;\n    \n    automation.activeAutomations = automationData.active || 0;\n    automation.totalTimeSaved += automationData.timeSaved || 0;\n    automation.scheduledTasks += automationData.scheduled || 0;\n    automation.completedTasks += automationData.completed || 0;\n    \n    // Calculate rates\n    const totalTasks = automation.scheduledTasks + automation.completedTasks;\n    automation.successRate = automation.completedTasks / totalTasks;\n    automation.errorRate = 1 - automation.successRate;\n    \n    // Efficiency calculation (tasks completed per hour)\n    automation.automationEfficiency = automation.completedTasks / (automation.totalTimeSaved / 60);\n    \n    // Track most used template\n    if (automationData.templateUsage) {\n      automation.mostUsedTemplate = Object.entries(automationData.templateUsage)\n        .sort(([,a], [,b]) => b - a)[0][0];\n    }\n    \n    await this.checkAutomationAlerts();\n  }\n\n  /**\n   * Update ROI and revenue metrics\n   */\n  async updateROIMetrics(revenueData) {\n    const roi = this.metrics.roi;\n    \n    roi.totalRevenue += revenueData.revenue || 0;\n    roi.marketingSpend += revenueData.spend || 0;\n    \n    // Calculate ROI\n    roi.roi = (roi.totalRevenue - roi.marketingSpend) / roi.marketingSpend;\n    \n    // Cost per acquisition\n    roi.costPerAcquisition = roi.marketingSpend / (revenueData.newCustomers || 1);\n    \n    // Lifetime value (simplified)\n    roi.lifetimeValue = revenueData.avgOrderValue * revenueData.avgOrdersPerCustomer;\n    \n    // Payback period in months\n    roi.paybackPeriod = roi.costPerAcquisition / (roi.lifetimeValue / 12);\n    \n    // Revenue growth rate\n    if (revenueData.previousPeriodRevenue) {\n      roi.revenueGrowth = (revenueData.revenue - revenueData.previousPeriodRevenue) / revenueData.previousPeriodRevenue;\n    }\n    \n    // Profit margin\n    roi.profitMargin = (roi.totalRevenue - roi.marketingSpend - (revenueData.cogs || 0)) / roi.totalRevenue;\n    \n    await this.checkROIAlerts();\n  }\n\n  /**\n   * Update website analytics\n   */\n  async updateWebsiteMetrics(websiteData) {\n    const website = this.metrics.website;\n    \n    website.visitors += websiteData.visitors || 0;\n    website.pageViews += websiteData.pageViews || 0;\n    website.bounceRate = websiteData.bounceRate || website.bounceRate;\n    website.averageSessionDuration = websiteData.avgSessionDuration || website.averageSessionDuration;\n    website.conversionRate = websiteData.conversions / websiteData.visitors;\n    \n    // Update top pages\n    if (websiteData.topPages) {\n      website.topPages = websiteData.topPages;\n    }\n    \n    // Update traffic sources\n    if (websiteData.trafficSources) {\n      website.trafficSources = websiteData.trafficSources;\n    }\n    \n    // Update device breakdown\n    if (websiteData.deviceBreakdown) {\n      website.deviceBreakdown = websiteData.deviceBreakdown;\n    }\n  }\n\n  /**\n   * Refresh all dashboard widgets\n   */\n  async refreshAllWidgets() {\n    for (const widget of Object.values(this.widgets)) {\n      await this.refreshWidget(widget.id);\n    }\n    \n    this.lastUpdate = DateTime.now();\n  }\n\n  /**\n   * Refresh specific widget\n   */\n  async refreshWidget(widgetId) {\n    const widget = this.widgets[widgetId];\n    if (!widget) return;\n    \n    switch (widgetId) {\n      case 'overview':\n        widget.data = this.generateOverviewData();\n        break;\n      case 'social-performance':\n        widget.data = this.generateSocialPerformanceData();\n        break;\n      case 'email-campaigns':\n        widget.data = this.generateEmailCampaignData();\n        break;\n      case 'roi-tracking':\n        widget.data = this.generateROIData();\n        break;\n      case 'automation-health':\n        widget.data = this.generateAutomationHealthData();\n        break;\n      case 'top-content':\n        widget.data = this.generateTopContentData();\n        break;\n      case 'traffic-sources':\n        widget.data = this.generateTrafficSourcesData();\n        break;\n      case 'conversion-funnel':\n        widget.data = this.generateConversionFunnelData();\n        break;\n    }\n    \n    widget.lastUpdated = DateTime.now().toISO();\n  }\n\n  /**\n   * Generate data for overview widget\n   */\n  generateOverviewData() {\n    return [\n      {\n        label: 'Total Reach',\n        value: this.metrics.social.totalReach.toLocaleString(),\n        change: '+12.5%',\n        trend: 'up',\n        icon: 'ðŸ“ˆ'\n      },\n      {\n        label: 'Email Open Rate',\n        value: (this.metrics.email.openRate * 100).toFixed(1) + '%',\n        change: '+2.3%',\n        trend: 'up',\n        icon: 'ðŸ“§'\n      },\n      {\n        label: 'Automation Success',\n        value: (this.metrics.automation.successRate * 100).toFixed(1) + '%',\n        change: '+0.8%',\n        trend: 'up',\n        icon: 'ðŸ¤–'\n      },\n      {\n        label: 'ROI',\n        value: (this.metrics.roi.roi * 100).toFixed(0) + '%',\n        change: '+18.2%',\n        trend: 'up',\n        icon: 'ðŸ’°'\n      },\n      {\n        label: 'Time Saved',\n        value: Math.round(this.metrics.automation.totalTimeSaved) + 'h',\n        change: '+156h',\n        trend: 'up',\n        icon: 'â°'\n      },\n      {\n        label: 'Website Conversion',\n        value: (this.metrics.website.conversionRate * 100).toFixed(2) + '%',\n        change: '+1.2%',\n        trend: 'up',\n        icon: 'ðŸŽ¯'\n      }\n    ];\n  }\n\n  /**\n   * Generate social performance chart data\n   */\n  generateSocialPerformanceData() {\n    const last30Days = this.metrics.social.dailyMetrics.slice(-30);\n    \n    return {\n      chartType: 'line',\n      xAxis: last30Days.map(d => d.date),\n      series: [\n        {\n          name: 'Reach',\n          data: last30Days.map(d => d.reach),\n          color: '#5B4EFF'\n        },\n        {\n          name: 'Engagement',\n          data: last30Days.map(d => d.engagement),\n          color: '#FF5B5B'\n        }\n      ]\n    };\n  }\n\n  /**\n   * Generate email campaign funnel data\n   */\n  generateEmailCampaignData() {\n    return {\n      stages: [\n        {\n          name: 'Sent',\n          value: this.metrics.email.totalSent,\n          percentage: 100\n        },\n        {\n          name: 'Delivered',\n          value: Math.round(this.metrics.email.totalSent * this.metrics.email.deliveryRate),\n          percentage: (this.metrics.email.deliveryRate * 100).toFixed(1)\n        },\n        {\n          name: 'Opened',\n          value: Math.round(this.metrics.email.totalSent * this.metrics.email.deliveryRate * this.metrics.email.openRate),\n          percentage: (this.metrics.email.openRate * 100).toFixed(1)\n        },\n        {\n          name: 'Clicked',\n          value: Math.round(this.metrics.email.totalSent * this.metrics.email.deliveryRate * this.metrics.email.openRate * this.metrics.email.clickRate),\n          percentage: (this.metrics.email.clickRate * 100).toFixed(1)\n        },\n        {\n          name: 'Converted',\n          value: Math.round(this.metrics.email.totalSent * this.metrics.email.deliveryRate * this.metrics.email.openRate * this.metrics.email.clickRate * this.metrics.email.conversionRate),\n          percentage: (this.metrics.email.conversionRate * 100).toFixed(1)\n        }\n      ]\n    };\n  }\n\n  /**\n   * Generate ROI gauge data\n   */\n  generateROIData() {\n    return {\n      current: this.metrics.roi.roi,\n      target: 3.0, // 300% target ROI\n      ranges: [\n        { min: 0, max: 1, color: '#FF5B5B', label: 'Poor' },\n        { min: 1, max: 2, color: '#FFB95B', label: 'Fair' },\n        { min: 2, max: 3, color: '#5BFFB9', label: 'Good' },\n        { min: 3, max: 5, color: '#5B4EFF', label: 'Excellent' }\n      ],\n      metrics: [\n        { label: 'Revenue', value: '$' + this.metrics.roi.totalRevenue.toLocaleString() },\n        { label: 'Spend', value: '$' + this.metrics.roi.marketingSpend.toLocaleString() },\n        { label: 'Profit', value: '$' + (this.metrics.roi.totalRevenue - this.metrics.roi.marketingSpend).toLocaleString() }\n      ]\n    };\n  }\n\n  /**\n   * Generate automation health status\n   */\n  generateAutomationHealthData() {\n    const health = this.calculateOverallHealth();\n    \n    return {\n      overallHealth: health.score,\n      status: health.status,\n      indicators: [\n        {\n          name: 'Success Rate',\n          value: (this.metrics.automation.successRate * 100).toFixed(1) + '%',\n          status: this.metrics.automation.successRate > 0.95 ? 'healthy' : 'warning',\n          icon: 'âœ…'\n        },\n        {\n          name: 'Active Automations',\n          value: this.metrics.automation.activeAutomations,\n          status: this.metrics.automation.activeAutomations > 0 ? 'healthy' : 'error',\n          icon: 'ðŸ¤–'\n        },\n        {\n          name: 'Error Rate',\n          value: (this.metrics.automation.errorRate * 100).toFixed(1) + '%',\n          status: this.metrics.automation.errorRate < 0.05 ? 'healthy' : 'warning',\n          icon: 'âš ï¸'\n        },\n        {\n          name: 'Efficiency',\n          value: this.metrics.automation.automationEfficiency.toFixed(1) + ' tasks/h',\n          status: this.metrics.automation.automationEfficiency > 10 ? 'healthy' : 'warning',\n          icon: 'âš¡'\n        }\n      ]\n    };\n  }\n\n  /**\n   * Generate top content table data\n   */\n  generateTopContentData() {\n    // Mock data - in production, this would come from actual content performance\n    return {\n      headers: ['Content', 'Platform', 'Reach', 'Engagement', 'Rate'],\n      rows: [\n        ['Marketing Automation Tips', 'Instagram', '15.2K', '1.8K', '11.8%'],\n        ['Product Launch Announcement', 'Twitter', '8.5K', '920', '10.8%'],\n        ['Case Study: 300% Growth', 'LinkedIn', '5.2K', '520', '10.0%'],\n        ['Tutorial: First Automation', 'Facebook', '12.1K', '1.1K', '9.1%'],\n        ['Behind the Scenes', 'Instagram', '9.8K', '850', '8.7%']\n      ]\n    };\n  }\n\n  /**\n   * Generate traffic sources donut data\n   */\n  generateTrafficSourcesData() {\n    return {\n      chartType: 'donut',\n      data: [\n        { name: 'Social Media', value: 35, color: '#5B4EFF' },\n        { name: 'Email Marketing', value: 28, color: '#FF5B5B' },\n        { name: 'Direct Traffic', value: 20, color: '#5BFFB9' },\n        { name: 'Search Engines', value: 12, color: '#FFB95B' },\n        { name: 'Referrals', value: 5, color: '#B95BFF' }\n      ],\n      total: this.metrics.website.visitors\n    };\n  }\n\n  /**\n   * Generate conversion funnel data\n   */\n  generateConversionFunnelData() {\n    const visitors = this.metrics.website.visitors;\n    const emailSignups = Math.round(visitors * 0.15); // 15% signup rate\n    const trialStarts = Math.round(emailSignups * 0.25); // 25% of signups start trial\n    const conversions = Math.round(trialStarts * 0.18); // 18% trial-to-paid conversion\n    \n    return {\n      stages: [\n        {\n          name: 'Website Visitors',\n          value: visitors,\n          percentage: 100,\n          color: '#E6E6FA'\n        },\n        {\n          name: 'Email Signups',\n          value: emailSignups,\n          percentage: ((emailSignups / visitors) * 100).toFixed(1),\n          color: '#C8C8FA'\n        },\n        {\n          name: 'Trial Started',\n          value: trialStarts,\n          percentage: ((trialStarts / visitors) * 100).toFixed(1),\n          color: '#AAAAFF'\n        },\n        {\n          name: 'Paid Conversion',\n          value: conversions,\n          percentage: ((conversions / visitors) * 100).toFixed(1),\n          color: '#5B4EFF'\n        }\n      ],\n      conversionRates: {\n        visitorToLead: ((emailSignups / visitors) * 100).toFixed(1) + '%',\n        leadToTrial: ((trialStarts / emailSignups) * 100).toFixed(1) + '%',\n        trialToPaid: ((conversions / trialStarts) * 100).toFixed(1) + '%',\n        overallConversion: ((conversions / visitors) * 100).toFixed(2) + '%'\n      }\n    };\n  }\n\n  /**\n   * Start real-time updates\n   */\n  startRealTimeUpdates() {\n    // Update widgets on different schedules based on refresh rates\n    for (const widget of Object.values(this.widgets)) {\n      setInterval(async () => {\n        await this.refreshWidget(widget.id);\n        this.notifyListeners(widget.id, widget.data);\n      }, widget.refreshRate);\n    }\n    \n    // Save data every hour\n    setInterval(async () => {\n      await this.saveHistoricalData();\n    }, 3600000);\n    \n    console.log('ðŸ”„ Real-time updates started');\n  }\n\n  /**\n   * Check for alerts across all metrics\n   */\n  async checkSocialAlerts() {\n    const social = this.metrics.social;\n    \n    if (social.averageEngagementRate < this.alerts.thresholds.lowEngagement) {\n      this.createAlert({\n        type: 'warning',\n        category: 'social',\n        message: `Social engagement rate (${(social.averageEngagementRate * 100).toFixed(2)}%) is below threshold`,\n        recommendation: 'Review content strategy and posting times',\n        severity: 'medium'\n      });\n    }\n  }\n\n  async checkEmailAlerts() {\n    const email = this.metrics.email;\n    \n    if (email.unsubscribeRate > this.alerts.thresholds.highUnsubscribe) {\n      this.createAlert({\n        type: 'warning',\n        category: 'email',\n        message: `Unsubscribe rate (${(email.unsubscribeRate * 100).toFixed(2)}%) is above threshold`,\n        recommendation: 'Review email frequency and content relevance',\n        severity: 'high'\n      });\n    }\n    \n    if (email.deliveryRate < this.alerts.thresholds.lowDelivery) {\n      this.createAlert({\n        type: 'error',\n        category: 'email',\n        message: `Email delivery rate (${(email.deliveryRate * 100).toFixed(1)}%) is below threshold`,\n        recommendation: 'Check sender reputation and email authentication',\n        severity: 'critical'\n      });\n    }\n  }\n\n  async checkAutomationAlerts() {\n    const automation = this.metrics.automation;\n    \n    if (automation.errorRate > this.alerts.thresholds.automationFailure) {\n      this.createAlert({\n        type: 'error',\n        category: 'automation',\n        message: `Automation error rate (${(automation.errorRate * 100).toFixed(1)}%) is above threshold`,\n        recommendation: 'Review automation logs and fix failing workflows',\n        severity: 'high'\n      });\n    }\n  }\n\n  async checkROIAlerts() {\n    const roi = this.metrics.roi;\n    \n    if (roi.roi < this.alerts.thresholds.roiThreshold) {\n      this.createAlert({\n        type: 'warning',\n        category: 'roi',\n        message: `ROI (${(roi.roi * 100).toFixed(0)}%) is below target threshold`,\n        recommendation: 'Optimize marketing spend allocation and conversion rates',\n        severity: 'medium'\n      });\n    }\n  }\n\n  /**\n   * Create new alert\n   */\n  createAlert(alertData) {\n    const alert = {\n      id: `alert_${Date.now()}`,\n      timestamp: DateTime.now().toISO(),\n      ...alertData,\n      acknowledged: false\n    };\n    \n    this.alerts.active.push(alert);\n    this.alerts.history.push(alert);\n    \n    // Keep history limited to last 100 alerts\n    if (this.alerts.history.length > 100) {\n      this.alerts.history = this.alerts.history.slice(-100);\n    }\n    \n    console.log(`ðŸš¨ Alert created: ${alert.message}`);\n    \n    // Notify listeners\n    this.notifyListeners('alerts', this.alerts.active);\n  }\n\n  /**\n   * Calculate overall system health\n   */\n  calculateOverallHealth() {\n    const scores = {\n      social: this.metrics.social.averageEngagementRate * 10, // 0-10 scale\n      email: (this.metrics.email.openRate + this.metrics.email.clickRate) * 5, // 0-10 scale\n      automation: this.metrics.automation.successRate * 10, // 0-10 scale\n      roi: Math.min(this.metrics.roi.roi / 3 * 10, 10) // 0-10 scale, capped at 10\n    };\n    \n    const overallScore = Object.values(scores).reduce((sum, score) => sum + score, 0) / 4;\n    \n    let status;\n    if (overallScore >= 8) status = 'excellent';\n    else if (overallScore >= 6) status = 'good';\n    else if (overallScore >= 4) status = 'fair';\n    else status = 'poor';\n    \n    return { score: overallScore, status };\n  }\n\n  /**\n   * Get best performing platform\n   */\n  getBestPerformingPlatform() {\n    const platforms = this.metrics.social.platformBreakdown;\n    let best = null;\n    let highestRate = 0;\n    \n    for (const [platform, metrics] of Object.entries(platforms)) {\n      if (metrics.engagementRate > highestRate) {\n        highestRate = metrics.engagementRate;\n        best = platform;\n      }\n    }\n    \n    return best;\n  }\n\n  /**\n   * Generate automated reports\n   */\n  async generateReport(type, dateRange) {\n    const report = {\n      id: `report_${type}_${Date.now()}`,\n      type,\n      dateRange,\n      generatedAt: DateTime.now().toISO(),\n      sections: []\n    };\n    \n    // Executive Summary\n    report.sections.push({\n      title: 'Executive Summary',\n      type: 'summary',\n      data: {\n        totalReach: this.metrics.social.totalReach,\n        emailsSent: this.metrics.email.totalSent,\n        automationsSaved: this.metrics.automation.totalTimeSaved,\n        roi: this.metrics.roi.roi,\n        keyInsights: this.generateKeyInsights()\n      }\n    });\n    \n    // Platform Performance\n    report.sections.push({\n      title: 'Platform Performance',\n      type: 'breakdown',\n      data: this.metrics.social.platformBreakdown\n    });\n    \n    // Email Campaign Analysis\n    report.sections.push({\n      title: 'Email Campaign Analysis',\n      type: 'email_analysis',\n      data: {\n        campaigns: this.metrics.email.recentCampaigns,\n        averageMetrics: {\n          openRate: this.metrics.email.openRate,\n          clickRate: this.metrics.email.clickRate,\n          conversionRate: this.metrics.email.conversionRate\n        }\n      }\n    });\n    \n    // ROI Analysis\n    report.sections.push({\n      title: 'ROI & Revenue Analysis',\n      type: 'financial',\n      data: this.metrics.roi\n    });\n    \n    // Recommendations\n    report.sections.push({\n      title: 'Recommendations',\n      type: 'recommendations',\n      data: this.generateRecommendations()\n    });\n    \n    // Store report\n    this.reports[type].push(report);\n    \n    return report;\n  }\n\n  /**\n   * Generate key insights\n   */\n  generateKeyInsights() {\n    const insights = [];\n    \n    // Best performing platform\n    const bestPlatform = this.getBestPerformingPlatform();\n    if (bestPlatform) {\n      insights.push(`${bestPlatform} is your top performing social platform with ${(this.metrics.social.platformBreakdown[bestPlatform].engagementRate * 100).toFixed(1)}% engagement rate`);\n    }\n    \n    // Email performance\n    if (this.metrics.email.openRate > 0.25) {\n      insights.push(`Email open rate (${(this.metrics.email.openRate * 100).toFixed(1)}%) exceeds industry average`);\n    }\n    \n    // Automation efficiency\n    insights.push(`Automations have saved ${Math.round(this.metrics.automation.totalTimeSaved)} hours of manual work`);\n    \n    // ROI performance\n    if (this.metrics.roi.roi > 3) {\n      insights.push(`Marketing ROI of ${(this.metrics.roi.roi * 100).toFixed(0)}% exceeds target performance`);\n    }\n    \n    return insights;\n  }\n\n  /**\n   * Generate recommendations\n   */\n  generateRecommendations() {\n    const recommendations = [];\n    \n    // Social media recommendations\n    if (this.metrics.social.averageEngagementRate < 0.03) {\n      recommendations.push({\n        category: 'Social Media',\n        priority: 'high',\n        action: 'Improve content strategy',\n        description: 'Engagement rate is below industry average. Consider A/B testing different content types and posting times.',\n        expectedImpact: 'Increase engagement by 15-25%'\n      });\n    }\n    \n    // Email recommendations\n    if (this.metrics.email.clickRate < 0.025) {\n      recommendations.push({\n        category: 'Email Marketing',\n        priority: 'medium',\n        action: 'Optimize email content',\n        description: 'Click rates could be improved with better CTAs and more relevant content.',\n        expectedImpact: 'Increase click rates by 20%'\n      });\n    }\n    \n    // Automation recommendations\n    if (this.metrics.automation.activeAutomations < 5) {\n      recommendations.push({\n        category: 'Automation',\n        priority: 'medium',\n        action: 'Expand automation coverage',\n        description: 'You could save more time by automating additional marketing tasks.',\n        expectedImpact: 'Save additional 10-15 hours per week'\n      });\n    }\n    \n    return recommendations;\n  }\n\n  /**\n   * Schedule automated reports\n   */\n  scheduleReports() {\n    // Daily report at 9 AM\n    const dailyReportTime = DateTime.now().set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n    const msUntilDaily = dailyReportTime.diff(DateTime.now()).milliseconds;\n    \n    setTimeout(() => {\n      setInterval(async () => {\n        const report = await this.generateReport('daily', { days: 1 });\n        console.log(`ðŸ“Š Daily report generated: ${report.id}`);\n      }, 86400000); // 24 hours\n    }, msUntilDaily > 0 ? msUntilDaily : msUntilDaily + 86400000);\n    \n    // Weekly report on Mondays at 9 AM\n    const weeklyReportTime = DateTime.now().set({ weekday: 1, hour: 9, minute: 0, second: 0, millisecond: 0 });\n    const msUntilWeekly = weeklyReportTime.diff(DateTime.now()).milliseconds;\n    \n    setTimeout(() => {\n      setInterval(async () => {\n        const report = await this.generateReport('weekly', { days: 7 });\n        console.log(`ðŸ“Š Weekly report generated: ${report.id}`);\n      }, 604800000); // 7 days\n    }, msUntilWeekly > 0 ? msUntilWeekly : msUntilWeekly + 604800000);\n  }\n\n  /**\n   * Real-time listener management\n   */\n  addListener(event, callback) {\n    if (!this.realTimeListeners.has(event)) {\n      this.realTimeListeners.set(event, []);\n    }\n    this.realTimeListeners.get(event).push(callback);\n  }\n\n  removeListener(event, callback) {\n    const listeners = this.realTimeListeners.get(event);\n    if (listeners) {\n      const index = listeners.indexOf(callback);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    }\n  }\n\n  notifyListeners(event, data) {\n    const listeners = this.realTimeListeners.get(event);\n    if (listeners) {\n      listeners.forEach(callback => callback(data));\n    }\n  }\n\n  /**\n   * Export dashboard data\n   */\n  exportDashboard(format = 'json') {\n    const exportData = {\n      metrics: this.metrics,\n      widgets: Object.fromEntries(\n        Object.entries(this.widgets).map(([id, widget]) => [id, {\n          title: widget.title,\n          type: widget.type,\n          data: widget.data,\n          lastUpdated: widget.lastUpdated\n        }])\n      ),\n      alerts: this.alerts.active,\n      lastUpdate: this.lastUpdate.toISO(),\n      health: this.calculateOverallHealth()\n    };\n    \n    if (format === 'json') {\n      return JSON.stringify(exportData, null, 2);\n    } else if (format === 'csv') {\n      return this.convertToCSV(exportData);\n    }\n    \n    return exportData;\n  }\n\n  /**\n   * Convert data to CSV format\n   */\n  convertToCSV(data) {\n    // Simplified CSV export for metrics\n    const csvRows = [\n      'Metric,Value',\n      `Total Reach,${data.metrics.social.totalReach}`,\n      `Email Open Rate,${(data.metrics.email.openRate * 100).toFixed(2)}%`,\n      `Automation Success Rate,${(data.metrics.automation.successRate * 100).toFixed(2)}%`,\n      `ROI,${(data.metrics.roi.roi * 100).toFixed(0)}%`,\n      `Time Saved,${Math.round(data.metrics.automation.totalTimeSaved)}h`\n    ];\n    \n    return csvRows.join('\\n');\n  }\n\n  /**\n   * Get dashboard summary for API\n   */\n  getSummary() {\n    return {\n      overview: this.generateOverviewData(),\n      health: this.calculateOverallHealth(),\n      alerts: this.alerts.active.length,\n      lastUpdate: this.lastUpdate.toISO(),\n      topMetrics: {\n        reach: this.metrics.social.totalReach,\n        emailOpenRate: this.metrics.email.openRate,\n        automationSuccess: this.metrics.automation.successRate,\n        roi: this.metrics.roi.roi\n      }\n    };\n  }\n}\n\nmodule.exports = AnalyticsDashboard;"